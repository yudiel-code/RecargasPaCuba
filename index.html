<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RecargasPaCuba</title>
  <meta name="theme-color" content="#87CEEB"/>
  <link rel="manifest" href="/manifest.json">

  <style>
    :root{
      --bg:#f6fbff; --card:#fff; --muted:#6b7280; --primary:#87CEEB; --accent:#0b84ff;
      --danger:#ff4d4f; --glass: rgba(255,255,255,0.7);
    }
    @media (prefers-color-scheme: dark) {
      :root{
        --bg:#0b0f14; --card:#0f1720; --muted:#9aa3b2;
        --primary:#0ea5e9; --accent:#0b84ff; --glass: rgba(255,255,255,0.04);
      }
      body{color:#e6eef6}
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:#0b1220}
    header.appbar{
      background:linear-gradient(90deg,var(--primary),#4fc3f7);
      color:#fff;padding:18px 14px;
      border-bottom-left-radius:12px;border-bottom-right-radius:12px;
    }
    header.appbar h1{margin:0;font-size:20px;text-align:center;letter-spacing:0.2px}
    .wrap{max-width:820px;margin:14px auto;padding:0 12px}
    .card{background:var(--card);border-radius:14px;padding:14px;margin-bottom:12px;
      box-shadow:0 8px 24px rgba(11,20,30,0.06)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input,select,textarea{
      width:100%;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);
      font-size:15px;background:transparent
    }
    button.btn{width:100%;padding:12px;border-radius:12px;border:none;background:var(--accent);
      color:#fff;font-weight:600;cursor:pointer}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px;color:var(--muted)}
    .operators{display:flex;gap:8px;align-items:center}
    .op{padding:8px 10px;border-radius:10px;background:var(--glass);
      display:flex;gap:8px;align-items:center;border:1px solid rgba(11,20,30,0.03)}
    .price-card{
      display:flex;justify-content:space-between;align-items:center;
      padding:10px;border-radius:10px;border:1px solid rgba(11,20,30,0.04);margin-top:8px
    }
    .price-card button{
      padding:8px 10px;border-radius:8px;background:#fff;
      border:1px solid rgba(11,20,30,0.06);cursor:pointer
    }
    nav.bottom{
      position:fixed;left:0;right:0;bottom:0;padding:10px 12px;
      background:transparent;display:flex;justify-content:center;pointer-events:none
    }
    .bottom-inner{max-width:820px;width:100%;display:flex;gap:8px;pointer-events:auto}
    .tab{
      flex:1;padding:12px;border-radius:12px;background:var(--card);
      text-align:center;border:1px solid rgba(11,20,30,0.04);cursor:pointer
    }
    .active{border:2px solid var(--accent)}
    .title{font-weight:700;font-size:18px;margin-bottom:6px}
    .promo{background:linear-gradient(90deg,#ffecd2,#fcb69f);padding:12px;border-radius:10px;color:#3b2f1d}
    .history-item{
      padding:10px;border-radius:10px;border:1px solid rgba(11,20,30,0.04);
      margin-bottom:8px;background:var(--card)
    }
    .flex{display:flex;gap:8px;align-items:center}
    footer.info{padding:24px 12px;text-align:center;color:var(--muted);font-size:13px;margin-top:70px}
    .top-right{position:absolute;right:16px;top:16px}
    .mini{font-size:12px;color:var(--muted)}
    @media(min-width:700px){.wrap{padding:0 40px}.card{padding:20px}}
  </style>
</head>

<body>

<header class="appbar">
  <h1>RecargasPaCuba</h1>
</header>

<div class="wrap">

  <!-- HOME -->
  <div class="card" id="homeCard">
    <div class="flex" style="justify-content:space-between;align-items:flex-start">
      <div>
        <div class="title">Recargas r√°pidas a Cuba</div>
        <div class="muted">Env√≠a saldo r√°pido. Funciona offline.</div>
      </div>
      <div class="top-right small" id="userBox"></div>
    </div>

    <div style="height:10px"></div>

    <div class="promo">üî• Promo demo: recarga + bonus (demo)</div>
  </div>

  <!-- RECARGAR -->
  <div class="card" id="rechargeCard">
    <div class="title">Enviar recarga</div>
    <div class="muted">Selecciona operador y cantidad.</div>

    <label for="operator">Operadora</label>
    <div class="operators">
      <div class="op">
        <select id="operator" style="border:none;background:transparent;padding:0;">
          <option value="cubacel">üá®üá∫ Cubacel</option>
          <option value="nauta">üì∂ Nauta</option>
          <option value="nauta_hogar">üè† Nauta Hogar</option>
        </select>
      </div>

      <div style="flex:1">
        <label for="phone">N√∫mero</label>
        <input id="phone" placeholder="53XXXXXXXXX"/>
      </div>
    </div>

    <label for="amount">Cantidad (USD)</label>
    <input id="amount" type="number" min="1" placeholder="Ej. 10"/>

    <div class="muted" style="margin-top:10px">Precios r√°pidos</div>
    <div id="prices"></div>

    <button id="sendBtn" class="btn" style="margin-top:12px">Enviar recarga</button>
    <div id="msg" style="margin-top:10px"></div>
  </div>

  <!-- HISTORIAL -->
  <div class="card" id="historyCard" style="display:none">
    <div class="title">Historial</div>
    <div class="muted">Recargas guardadas y enviadas.</div>
    <div id="historyList" style="margin-top:12px"></div>
  </div>

  <!-- CUENTA -->
  <div class="card" id="accountCard" style="display:none">
    <div class="title">Cuenta</div>
    <div id="accountArea"></div>

    <label style="margin-top:12px">Color primario</label>
    <input id="primaryColor" type="color" value="#87CEEB"/>

    <button id="saveSettingsBtn" class="btn" style="margin-top:10px;background:#0b84ff">Guardar ajustes</button>
  </div>

  <footer class="info">RecargasPaCuba ‚Äî Demo ¬∑ Hecho con ‚ù§Ô∏è</footer>
</div>

<!-- NAV -->
<nav class="bottom">
  <div class="bottom-inner">
    <div id="tab-home" class="tab active">Inicio</div>
    <div id="tab-recharge" class="tab">Recargar</div>
    <div id="tab-history" class="tab">Historial</div>
    <div id="tab-account" class="tab">Cuenta</div>
  </div>
</nav>

<script>
/* Helpers */
const $ = id => document.getElementById(id);

const state = {
  user: localStorage.getItem('rp_user') ? JSON.parse(localStorage.getItem('rp_user')) : null,
  history: JSON.parse(localStorage.getItem('rp_history')||'[]'),
  prices: {
    cubacel: [5,10,20,50],
    nauta: [3,5,10],
    nauta_hogar: [10,20,50]
  }
};

function saveState(){ localStorage.setItem('rp_history', JSON.stringify(state.history)); }
function uid(){ return Math.random().toString(36).slice(2,9); }

function showMsg(text,type='ok'){
  const el = $('msg');
  if(!text){ el.innerHTML=''; return; }
  el.innerHTML = `<div style="padding:10px;border-radius:8px;background:${type==='error'?'#ff4d4f':'#0b84ff'};color:white">${text}</div>`;
  setTimeout(()=> el.innerHTML='',4000);
}

function renderUserBox(){
  const box = $('userBox');
  if(state.user)
    box.innerHTML = `<div class="mini">Hola, <strong>${state.user.name}</strong></div>`;
  else
    box.innerHTML = `<div class="mini">No conectado</div>`;
}

function renderPrices(){
  const sel = $('operator').value;
  const container = $('prices');
  container.innerHTML = state.prices[sel].map(p=>`
    <div class="price-card">
      <div><strong>$${p}</strong><div class="small muted">Recarga r√°pida</div></div>
      <button class="priceBtn" data-price="${p}">Usar</button>
    </div>
  `).join('');

  document.querySelectorAll('.priceBtn').forEach(b=>{
    b.addEventListener('click', ()=> $('amount').value = b.getAttribute('data-price'));
  });
}

function renderHistory(){
  const list = $('historyList');
  if(state.history.length===0){
    list.innerHTML = '<div class="small muted">No hay recargas</div>';
    return;
  }

  list.innerHTML = state.history.map(r=>`
    <div class="history-item">
      <div style="display:flex;justify-content:space-between">
        <div><strong>${r.operator.toUpperCase()}</strong><div class="small muted">${r.phone}</div></div>
        <div><strong>$${r.amount}</strong><div class="small">${new Date(r.date).toLocaleString()}</div></div>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px">
        ${r.sent ? '<div class="small">Enviado ‚úì</div>' : `<button class="btn retryBtn" data-id="${r.id}" style="background:#fff;color:#0b84ff">Reintentar</button>`}
        <button class="btn" onclick="removeItem('${r.id}')" style="background:#fff;color:#111">Eliminar</button>
      </div>
    </div>
  `).join('');

  document.querySelectorAll('.retryBtn').forEach(b=>{
    b.addEventListener('click', ()=> retrySend(b.getAttribute('data-id')));
  });
}

const tabs = ['home','recharge','history','account'];
tabs.forEach(t=> $('tab-'+t).addEventListener('click', ()=> openTab(t)));

function openTab(t){
  tabs.forEach(x=>{
    $('tab-'+x).classList.remove('active');
    const card = x==='home' ? 'homeCard' :
                 x==='recharge' ? 'rechargeCard' :
                 x==='history' ? 'historyCard' : 'accountCard';
    $(card).style.display = 'none';
  });

  $('tab-'+t).classList.add('active');
  const showCard = t==='home' ? 'homeCard' :
                   t==='recharge' ? 'rechargeCard' :
                   t==='history' ? 'historyCard' : 'accountCard';
  $(showCard).style.display = 'block';

  if(t==='recharge') renderPrices();
  if(t==='history') renderHistory();
  if(t==='account') renderAccountArea();
}

function renderAccountArea(){
  const area = $('accountArea');

  if(state.user){
    area.innerHTML = `
      <div class="muted">Conectado como <strong>${state.user.name}</strong></div>
      <div style="height:10px"></div>
      <div class="muted small">Email</div>
      <div class="small">${state.user.email}</div>
      <div style="height:12px"></div>
      <button id="logoutBtn" class="btn" style="background:#ff6b6b">Cerrar sesi√≥n</button>
    `;

    $('logoutBtn').addEventListener('click', ()=>{
      state.user = null;
      localStorage.removeItem('rp_user');
      renderUserBox();
      renderAccountArea();
      showMsg('Sesi√≥n cerrada');
    });

  } else {
    area.innerHTML = `
      <div class="muted">Inicia sesi√≥n (demo)</div>
      <label>Nombre</label>
      <input id="loginName" placeholder="Tu nombre"/>
      <label style="margin-top:8px">Email</label>
      <input id="loginEmail" placeholder="email@ejemplo.com"/>
      <button id="loginDo" class="btn">Iniciar sesi√≥n</button>
    `;

    $('loginDo').addEventListener('click', ()=>{
      const n = $('loginName').value.trim();
      const e = $('loginEmail').value.trim();
      if(!n || !e){ showMsg('Nombre y email requeridos','error'); return; }

      state.user = { name:n, email:e };
      localStorage.setItem('rp_user', JSON.stringify(state.user));
      renderUserBox();
      renderAccountArea();
      showMsg('Sesi√≥n iniciada');
    });
  }
}

function removeItem(id){
  state.history = state.history.filter(h=>h.id!==id);
  saveState();
  renderHistory();
}

async function retrySend(id){
  const item = state.history.find(h=>h.id===id);
  if(!item) return;

  showMsg('Reintentando...');
  await new Promise(r=>setTimeout(r,800));
  item.sent = true;
  saveState();
  renderHistory();
  showMsg('Enviado correctamente');
}

$('sendBtn').addEventListener('click', ()=>{
  const phone = $('phone').value.trim();
  const operator = $('operator').value;
  const amount = Number($('amount').value);

  if(!phone || phone.length<8){ showMsg('N√∫mero inv√°lido','error'); return; }
  if(!amount || amount<=0){ showMsg('Cantidad inv√°lida','error'); return; }

  const rec = {
    id: uid(),
    phone, operator, amount,
    date: new Date().toISOString(),
    sent: false
  };

  state.history.unshift(rec);
  saveState();
  renderHistory();
  showMsg('Guardado (modo demo)');
});

$('saveSettingsBtn').addEventListener('click', ()=>{
  const c = $('primaryColor').value;
  document.querySelector('.appbar').style.background =
      `linear-gradient(90deg, ${c}, #4fc3f7)`;
  localStorage.setItem('rp_primary', c);
  showMsg('Ajustes guardados');
});

/* INIT */
(function init(){
  if(localStorage.getItem('rp_primary')){
    const c = localStorage.getItem('rp_primary');
    $('primaryColor').value = c;
    document.querySelector('.appbar').style.background =
        `linear-gradient(90deg, ${c}, #4fc3f7)`;
  }

  renderUserBox();
  renderPrices();
  renderHistory();
  renderAccountArea();

  // üî• SERVICE WORKER ELIMINADO COMPLETAMENTE
  // (NO se registra, no se instala, no se usa)

  openTab('recharge');
})();
</script>

</body>
</html>
