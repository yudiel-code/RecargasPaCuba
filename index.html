<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RecargasPaCuba</title>
  <meta name="theme-color" content="#87CEEB"/>
  <link rel="manifest" href="/RecargasPaCuba/manifest.json">

  <style>
    :root{
      --bg:#f6fbff; --card:#fff; --muted:#6b7280; --primary:#87CEEB; --accent:#0b84ff; --danger:#ff4d4f;
      --glass: rgba(255,255,255,0.7);
    }
    @media (prefers-color-scheme: dark) {
      :root{ --bg:#0b0f14; --card:#0f1720; --muted:#9aa3b2; --primary:#0ea5e9; --accent:#0b84ff; --glass: rgba(255,255,255,0.04);}
      body{color:#e6eef6}
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:var(--bg);color:#0b1220}

    header.appbar{
      background:linear-gradient(90deg,var(--primary),#4fc3f7);
      color:#fff;padding:18px 14px;
      border-bottom-left-radius:12px;
      border-bottom-right-radius:12px;
      text-align:center;
      font-size:20px;
      font-weight:700;
    }

    .wrap{max-width:820px;margin:14px auto;padding:0 12px}
    .card{background:var(--card);border-radius:14px;padding:14px;margin-bottom:12px;box-shadow:0 8px 24px rgba(11,20,30,0.06)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input,select{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);font-size:15px;background:transparent}

    button.btn{
      width:100%;padding:12px;border-radius:12px;border:none;
      background:var(--accent);color:#fff;font-weight:600;cursor:pointer
    }

    .row{display:flex;gap:10px}
    .row>*{flex:1}

    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px;color:var(--muted)}

    .operators{display:flex;gap:8px;align-items:center}
    .op{padding:8px 10px;border-radius:10px;background:var(--glass);display:flex;gap:8px;align-items:center;border:1px solid rgba(11,20,30,0.03)}

    .price-card{
      display:flex;justify-content:space-between;align-items:center;
      padding:10px;border-radius:10px;border:1px solid rgba(11,20,30,0.04);margin-top:8px
    }
    .price-card button{padding:8px 10px;border-radius:8px;background:#fff;border:1px solid rgba(11,20,30,0.06)}

    nav.bottom{
      position:fixed;left:0;right:0;bottom:0;padding:10px 12px;
      display:flex;justify-content:center;background:transparent;pointer-events:none
    }
    .bottom-inner{max-width:820px;width:100%;display:flex;gap:8px;pointer-events:auto}
    .tab{flex:1;padding:12px;border-radius:12px;background:var(--card);text-align:center;border:1px solid rgba(11,20,30,0.04);cursor:pointer}
    .active{border:2px solid var(--accent)}

    .title{font-weight:700;font-size:18px;margin-bottom:6px}
    .promo{background:linear-gradient(90deg,#ffecd2,#fcb69f);padding:12px;border-radius:10px;color:#3b2f1d}

    .history-item{padding:10px;border-radius:10px;border:1px solid rgba(11,20,30,0.04);margin-bottom:8px;background:var(--card)}

    footer.info{text-align:center;color:var(--muted);font-size:13px;margin:70px 0 20px}
  </style>
</head>

<body>

<header class="appbar">RecargasPaCuba</header>

<div class="wrap">

  <!-- HOME -->
  <div class="card" id="homeCard">
      <div class="title">Recargas r√°pidas a Cuba</div>
      <div class="muted">Env√≠a saldo r√°pido. Funciona offline.</div>
      <div style="height:10px"></div>
      <div class="promo">üî• Promo demo: recarga + bonus (demo)</div>
  </div>

  <!-- RECARGAR -->
  <div class="card" id="rechargeCard" style="display:none">
    <div class="title">Enviar recarga</div>
    <div class="muted">Si no hay servidor, la recarga se guarda localmente.</div>

    <label>Operadora</label>
    <div class="operators">
      <div class="op">
        <select id="operator">
          <option value="cubacel">üá®üá∫ Cubacel</option>
          <option value="nauta">üì∂ Nauta</option>
          <option value="nauta_hogar">üè† Nauta Hogar</option>
        </select>
      </div>
      <div style="flex:1">
        <label>N√∫mero</label>
        <input id="phone" placeholder="53XXXXXXXXX">
      </div>
    </div>

    <label style="margin-top:10px">Cantidad (USD)</label>
    <input id="amount" type="number" min="1" placeholder="Ej. 10">

    <div class="muted" style="margin-top:12px">Precios r√°pidos</div>
    <div id="prices"></div>

    <button id="sendBtn" class="btn" style="margin-top:12px">Enviar recarga</button>
    <div id="msg" style="margin-top:10px"></div>
  </div>

  <!-- HISTORIAL -->
  <div class="card" id="historyCard" style="display:none">
    <div class="title">Historial</div>
    <div class="muted">Recargas guardadas o enviadas.</div>
    <div id="historyList" style="margin-top:12px"></div>
  </div>

  <!-- CUENTA -->
  <div class="card" id="accountCard" style="display:none">
    <div class="title">Cuenta</div>
    <div id="accountArea"></div>

    <label style="margin-top:12px">Color primario</label>
    <input id="primaryColor" type="color" value="#87CEEB">

    <button id="saveSettingsBtn" class="btn" style="margin-top:10px;background:#0b84ff">Guardar ajustes</button>
  </div>

  <footer class="info">RecargasPaCuba ‚Äî Demo ¬∑ Hecho con ‚ù§Ô∏è</footer>
</div>

<!-- TABS -->
<nav class="bottom">
  <div class="bottom-inner">
    <div id="tab-home" class="tab active">Inicio</div>
    <div id="tab-recharge" class="tab">Recargar</div>
    <div id="tab-history" class="tab">Historial</div>
    <div id="tab-account" class="tab">Cuenta</div>
  </div>
</nav>

<script>
/* ===== Helpers ===== */
const $ = id => document.getElementById(id);

const state = {
  user: localStorage.getItem("rp_user") ? JSON.parse(localStorage.getItem("rp_user")) : null,
  history: JSON.parse(localStorage.getItem("rp_history") || "[]"),
  prices: {
    cubacel: [5,10,20,50],
    nauta: [3,5,10],
    nauta_hogar: [10,20,50]
  }
};

function saveState(){ localStorage.setItem("rp_history", JSON.stringify(state.history)); }
function uid(){ return Math.random().toString(36).slice(2,9); }

function showMsg(t, type="ok"){
  $("msg").innerHTML = t
    ? `<div style="padding:10px;border-radius:8px;background:${type==="error" ? "#ffdddd" : "#ddffdd"}">${t}</div>`
    : "";
}

/* ===== Render ===== */

function renderPrices(){
  const op = $("operator").value;
  $("prices").innerHTML = state.prices[op].map(p => `
    <div class="price-card">
      <div><strong>$${p}</strong><div class="small muted">Recarga r√°pida</div></div>
      <button onclick="document.getElementById('amount').value=${p}">Usar</button>
    </div>
  `).join("");
}

function renderHistory(){
  const list = $("historyList");
  if(state.history.length===0){
    list.innerHTML = "<div class='small muted'>No hay recargas</div>";
    return;
  }
  list.innerHTML = state.history.map(r=>`
    <div class="history-item">
      <div style="display:flex;justify-content:space-between">
        <div><strong>${r.operator.toUpperCase()}</strong><div class="small muted">${r.phone}</div></div>
        <div><strong>$${r.amount}</strong><div class="small">${new Date(r.date).toLocaleString()}</div></div>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px">
        ${r.sent ? "<div class='small'>Enviado ‚úì</div>" :
        `<button class="btn" style="background:#fff;color:#0b84ff" onclick="retrySend('${r.id}')">Reintentar</button>`}

        <button class="btn" style="background:#fff;color:#111" onclick="removeItem('${r.id}')">Eliminar</button>
      </div>
    </div>
  `).join("");
}

function renderAccountArea(){
  const a = $("accountArea");
  if(state.user){
    a.innerHTML = `
      <div class="muted small">Conectado como <strong>${state.user.name}</strong></div>
      <div class="small" style="margin-top:6px">${state.user.email}</div>
      <button class="btn" style="margin-top:12px;background:#ff4d4f" onclick="logout()">Cerrar sesi√≥n</button>
    `;
  } else {
    a.innerHTML = `
      <label>Nombre</label>
      <input id="loginName">

      <label style="margin-top:8px">Email</label>
      <input id="loginEmail">

      <button class="btn" style="margin-top:10px" onclick="login()">Iniciar sesi√≥n</button>
    `;
  }
}

/* ===== Login ===== */
function login(){
  const n = $("loginName").value.trim();
  const e = $("loginEmail").value.trim();
  if(!n || !e){ showMsg("Nombre y email obligatorios","error"); return; }
  state.user = {name:n,email:e};
  localStorage.setItem("rp_user", JSON.stringify(state.user));
  renderAccountArea();
  showMsg("Sesi√≥n iniciada");
}

function logout(){
  state.user = null;
  localStorage.removeItem("rp_user");
  renderAccountArea();
  showMsg("Sesi√≥n cerrada");
}

/* ===== Env√≠o ===== */
async function retrySend(id){
  showMsg("Demo: sin servidor real","error");
}

$("sendBtn").addEventListener("click", ()=>{
  const phone = $("phone").value.trim();
  const op = $("operator").value;
  const amount = Number($("amount").value);

  if(!phone || phone.length<8){ showMsg("N√∫mero inv√°lido","error"); return; }
  if(amount<=0){ showMsg("Cantidad inv√°lida","error"); return; }

  const rec = {id:uid(),phone:phone,operator:op,amount:amount,date:new Date().toISOString(),sent:false};
  state.history.unshift(rec);
  saveState();
  renderHistory();
  showMsg("Guardada (demo)");
});

/* ===== Tabs ===== */
function openTab(t){
  ["home","recharge","history","account"].forEach(x=>{
    $("tab-"+x).classList.remove("active");
    $(x+"Card").style.display="none";
  });
  $("tab-"+t).classList.add("active");
  $(t+"Card").style.display="block";

  if(t==="recharge") renderPrices();
  if(t==="history") renderHistory();
  if(t==="account") renderAccountArea();
}

$("tab-home").onclick = ()=>openTab("home");
$("tab-recharge").onclick = ()=>openTab("recharge");
$("tab-history").onclick = ()=>openTab("history");
$("tab-account").onclick = ()=>openTab("account");

/* ===== Settings ===== */
$("saveSettingsBtn").onclick = ()=>{
  const c = $("primaryColor").value;
  document.querySelector(".appbar").style.background = `linear-gradient(90deg, ${c}, #4fc3f7)`;
  localStorage.setItem("rp_primary", c);
  showMsg("Ajustes guardados");
};

/* ===== Init ===== */
(function(){
  if(localStorage.getItem("rp_primary")){
    const c = localStorage.getItem("rp_primary");
    $("primaryColor").value = c;
    document.querySelector(".appbar").style.background = `linear-gradient(90deg, ${c}, #4fc3f7)`;
  }

  renderPrices();
  renderHistory();
  renderAccountArea();

  // Registro correcto del nuevo service worker
  if("serviceWorker" in navigator){
    navigator.serviceWorker.register("/RecargasPaCuba/service-worker.js");
  }

  openTab("home");
})();
</script>

</body>
</html>
