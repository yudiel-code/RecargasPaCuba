<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RecargasPaCuba</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0d63c9">

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: Inter, system-ui, Arial, sans-serif;
      background:#0b0f13;
      color:white;
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }
    .app{max-width:820px;margin:auto;width:100%;padding:16px;flex:1 0 auto}

    #screen-home {
      display:flex;
      align-items:flex-start;
      justify-content:center;
      min-height:100vh;
      background: linear-gradient(180deg,#2fb8d6 0%, #2ba6d0 35%, #1aa0c3 70%);
      padding-top:42px;
    }

    .login-wrap{
      width:100%;
      max-width:420px;
      text-align:center;
      color:#ffffff;
      padding:18px;
    }

    .logo-big{
      width:220px;
      height:220px;
      margin:0 auto 8px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .logo-big img{width:90%;height:auto;border-radius:50%}

    .login-title{
      font-size:40px;
      font-weight:800;
      margin-top:8px;
    }

    .login-sub{margin-top:8px;font-size:16px}

    .input-pill{
      display:block;
      margin:14px auto;
      width:92%;
      max-width:360px;
      background: rgba(255,255,255,0.18);
      border-radius:40px;
      padding:18px 22px;
      color:#02333a;
      font-size:18px;
      border:none;
      outline:none;
    }

    .btn-primary-big{
      display:block;
      margin:16px auto 8px;
      width:92%;
      max-width:360px;
      padding:16px 22px;
      border-radius:40px;
      background: #ffb13b;
      color:#2c1a00;
      font-weight:800;
      font-size:18px;
      border: none;
      cursor:pointer;
    }

    .btn-secondary{
      background:transparent;
      border:1px solid rgba(255,255,255,0.4);
      color:#fff;
      padding:12px;
      border-radius:12px;
      margin-top:8px;
      cursor:pointer;
      width:92%;
      max-width:360px;
    }

    .btn-google{
      margin-top:14px;
      width:92%;
      max-width:360px;
      padding:14px 18px;
      border-radius:40px;
      background:#fff;
      color:#222;
      font-weight:700;
      border:none;
      cursor:pointer;
    }

    nav.bottom{
      position:fixed;left:12px;right:12px;bottom:18px;
      display:flex;justify-content:space-around;
      padding:10px 14px;border-radius:18px;
      background: linear-gradient(90deg,#0b63d1,#19c6c3);
    }
    .nav-btn{color:white;font-weight:800;cursor:pointer}

    section{display:none}
  </style>
</head>

<body>

<main class="app">

<section id="screen-home" style="display:block">
  <div class="login-wrap">

    <div class="logo-big">
      <img src="icon-256.png">
    </div>

    <div class="login-title">Iniciar Sesión</div>

    <div class="login-sub">
      ¿Eres nuevo?
      <a href="#" id="link-register" style="font-weight:800;color:#fff7b8">Regístrate aquí</a>
    </div>

    <!-- LOGIN -->
    <input id="login-identifier" class="input-pill" placeholder="Email o usuario" />
    <input id="login-password" class="input-pill" placeholder="Contraseña" type="password" />

    <button id="btn-login-do" class="btn-primary-big">Continuar</button>
    <button class="btn-google">Continuar con Google</button>

    <!-- REGISTRO REAL -->
    <div id="register-box" style="display:none;margin-top:10px">

      <input id="reg-username" class="input-pill" placeholder="Usuario" />
      <input id="reg-email" class="input-pill" placeholder="Email" />
      <input id="reg-phone" class="input-pill" placeholder="Teléfono" />
      <input id="reg-password" class="input-pill" placeholder="Contraseña" type="password" />
      <input id="reg-password2" class="input-pill" placeholder="Repetir contraseña" type="password" />

      <button id="btn-register-do" class="btn-primary-big">Crear cuenta</button>
      <button id="btn-cancel-register" class="btn-secondary">Cancelar</button>

    </div>

  </div>
</section>

</main>

<nav class="bottom">
  <div class="nav-btn" id="nav-home">Inicio</div>
</nav>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}

const STORAGE_KEY="rpc_user";

const loginIdentifier=document.getElementById("login-identifier");
const loginPassword=document.getElementById("login-password");
const btnLoginDo=document.getElementById("btn-login-do");

const regUsername=document.getElementById("reg-username");
const regEmail=document.getElementById("reg-email");
const regPhone=document.getElementById("reg-phone");
const regPassword=document.getElementById("reg-password");
const regPassword2=document.getElementById("reg-password2");
const btnRegisterDo=document.getElementById("btn-register-do");

const linkRegister=document.getElementById("link-register");
const registerBox=document.getElementById("register-box");
const btnCancelRegister=document.getElementById("btn-cancel-register");

function saveUser(obj){localStorage.setItem(STORAGE_KEY,JSON.stringify(obj))}
function getUser(){return JSON.parse(localStorage.getItem(STORAGE_KEY)||"null")}

btnRegisterDo.onclick=()=>{
  let username=regUsername.value.trim();
  const email=regEmail.value.trim();
  const phone=regPhone.value.trim();
  const pass1=regPassword.value;
  const pass2=regPassword2.value;

  if(pass1.length<6) return alert("Contraseña mínimo 6 caracteres");
  if(pass1!==pass2) return alert("Las contraseñas no coinciden");
  if(!username && !email) return alert("Usuario o email obligatorio");

  if(!username && email) username=email.split("@")[0];

  const user={username,email,phone,password:pass1};
  saveUser(user);

  alert("Cuenta creada correctamente ✅");
  registerBox.style.display="none";
};

btnLoginDo.onclick=()=>{
  const id=loginIdentifier.value.trim();
  const pwd=loginPassword.value;
  const user=getUser();

  if(!user) return alert("No existe ningún usuario");

  const ok=
    (user.username && id===user.username) ||
    (user.email && id.toLowerCase()===user.email.toLowerCase());

  if(ok && pwd===user.password){
    alert("Sesión iniciada ✅");
  }else{
    alert("Datos incorrectos ❌");
  }
};

linkRegister.onclick=(e)=>{
  e.preventDefault();
  registerBox.style.display="block";
};

btnCancelRegister.onclick=()=>{
  registerBox.style.display="none";
};
</script>

</body>
</html>
