<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cuenta | RecargasPaCuba</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="color-scheme" content="light">
  <meta name="theme-color" content="#28c6db">

  <style>
    html, body {
      background: linear-gradient(135deg, #0a5fcb, #0db3da) !important;
    }
    * { animation: none !important; transition: none !important; }
  </style>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap');

    :root{
      --left:#0b63d1;
      --right:#19c6c3;
      --glass: rgba(255,255,255,0.18);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0a5fcb, #0db3da);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-bottom: 150px;
    }

    .app {
      width: 100%;
      max-width: 520px;
      padding: 22px 18px 0;
      display: flex;
      flex-direction: column;
      gap: 22px;
      position: relative; /* para el widget de monedas */
    }

    .card {
      background: var(--glass);
      border-radius: 22px;
      padding: 18px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.25);
    }

    .perfil {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      position: relative;
      margin-bottom: 10px;
    }

    .avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: rgba(255,255,255,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .avatar svg {
      width: 50px;
      height: 50px;
      fill: #fff;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    /* üîß Punto verde recolocado */
    .estado-online {
  width: 14px;
  height: 14px;
  background: #3ddc97;
  border-radius: 50%;
  position: absolute;
  bottom: -2px;
  right: -2px;
  border: 2px solid white;
}

    .user-name {
      font-size: 18px;
      font-weight: 800;
      margin-top: 8px;
    }

    .user-status {
      font-size: 12px;
      opacity: 0.9;
    }

    .verificacion {
      text-align: center;
      font-size: 14px;
      font-weight: 700;
      margin-top: 6px;
      color: #3ddc97;
    }

    .saldo-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .saldo-title {
      font-size: 15px;
      opacity: 0.9;
    }

    .saldo {
      font-size: 38px;
      font-weight: 800;
    }

    .ultimo-mov {
      margin-top: 10px;
      font-size: 13px;
      opacity: 0.9;
    }

    .ver-historial {
      margin-top: 8px;
      font-size: 13px;
      text-decoration: underline;
      cursor: pointer;
    }

    .acciones {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .btn {
      width: 100%;
      border: none;
      border-radius: 26px;
      padding: 16px;
      font-size: 17px;
      font-weight: 700;
      background: linear-gradient(145deg, #ffae43, #ff941f);
      color: #2e1200;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(0,0,0,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .soporte-btn {
      margin-top: 6px;
      background: linear-gradient(145deg, #4bbcff, #2ea5ff);
      color: #00203d;
    }

    .legales {
      margin-top: 8px;
      text-align: center;
      font-size: 12px;
      opacity: 0.85;
    }

    .legales a {
      color: white;
      text-decoration: underline;
      margin: 0 6px;
    }

    /* Overlays de modales */
    .modal-bg-saldo,
    .modal-bg-metodo,
    .modal-bg-cuenta {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.55);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 3000;
      backdrop-filter: blur(6px);
    }

    .modal {
      background: rgba(255,255,255,0.10);
      padding: 22px;
      border-radius: 16px;
      max-width: 85%;
      text-align: center;
      color: #fff;
      border: 1px solid rgba(255,255,255,0.25);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      backdrop-filter: blur(12px);
    }

    .modal button {
      margin-top: 16px;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background: #ffb13b;
      color: #2c1200;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
    }

    .modal input {
      width: 80%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      margin-top: 12px;
      font-size: 16px;
      text-align: center;
    }

    /* Opciones de m√©todo de pago */
    .metodo-lista {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }

    .metodo-opcion {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.35);
      background: rgba(0,0,0,0.15);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .metodo-opcion span.metodo-nombre {
      text-align: left;
    }

    .metodo-opcion span.metodo-tag {
      font-size: 11px;
      opacity: 0.85;
    }

    .metodo-opcion:hover {
      background: rgba(255,255,255,0.15);
    }

    /* Campos de modal de cuenta */
    .cuenta-campos {
      margin-top: 10px;
      text-align: left;
      font-size: 13px;
    }

    .campo {
      margin-bottom: 10px;
    }

    .campo-label {
      opacity: 0.85;
      font-size: 12px;
    }

    .campo input {
      width: 100%;
      margin-top: 4px;
      padding: 8px 10px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      text-align: left;
    }

    .campo-password {
      position: relative;
    }

    .campo-password input {
      padding-right: 40px;
    }

    .ojo-toggle {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 16px;
      cursor: pointer;
      opacity: 0.85;
    }

    nav.bottom {
      position: fixed;
      left: 12px;
      right: 12px;
      bottom: 18px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px 14px;
      border-radius: 18px;
      background: linear-gradient(90deg,var(--left),var(--right));
      box-shadow: 0 12px 30px rgba(8,20,40,0.32);
      z-index: 2000;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.25);
    }

    nav.bottom .nav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      color: white;
      font-weight: 800;
      padding: 8px 12px;
      border-radius: 10px;
      text-decoration: none;
    }

    nav.bottom .nav-btn.active {
      transform: translateY(-6px);
      background: rgba(255,255,255,0.12);
      box-shadow: 0 8px 18px rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.25);
    }

    /* üí∞ Widget monedas (solo icono + n√∫mero) */
    .coin-widget {
      position: absolute;
      top: 6px;
      right: 6px;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      z-index: 500;
    }

    /* Modal espec√≠fico para monedas */
    .modal-bg-monedas {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.55);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 3500;
      backdrop-filter: blur(6px);
    }

    .modal-monedas {
      background: rgba(255,255,255,0.10);
      padding: 20px;
      border-radius: 16px;
      width: 85%;
      max-width: 360px;
      text-align: center;
      color: #fff;
      border: 1px solid rgba(255,255,255,0.25);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      backdrop-filter: blur(12px);
    }

    .progress-bar {
      margin-top: 12px;
      height: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 20px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg,#ffd36b,#ff9f00);
    }

    .btn-canje {
      margin-top: 16px;
      padding: 12px;
      width: 100%;
      border: none;
      border-radius: 12px;
      font-weight: 800;
      background: #888;
      color: #222;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .btn-canje.activo {
      background: linear-gradient(145deg, #ffae43, #ff941f);
      cursor: pointer;
      opacity: 1;
    }
  </style>
</head>

<body>

  <main class="app">

    <!-- ü™ô Widget monedas arriba derecha -->
    <div class="coin-widget" id="coinWidget">
      ü™ô <span id="coinTotal">0</span>
    </div>

    <div class="perfil">
      <div class="avatar" id="avatarBox">
        <img id="avatarImg" style="display:none;" alt="Avatar usuario">
        <svg viewBox="0 0 24 24">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-3.33 0-10 1.67-10 5v1h20v-1c0-3.33-6.67-5-10-5z"/>
        </svg>
        <div class="estado-online"></div>
      </div>
      <!-- input para subir avatar -->
      <input type="file" id="inputAvatar" accept="image/*" hidden>

      <div id="emailUsuario" class="user-name"></div>
      <div class="user-status">Cuenta activa ‚úÖ</div>
      <div class="verificacion">Usuario verificado ‚úÖ</div>
    </div>

    <div class="card saldo-box">
      <div class="saldo-title">Saldo disponible</div>
      <div id="saldo" class="saldo">0,00 ‚Ç¨</div>
      <div id="ultimoMovimiento" class="ultimo-mov">√öltimo movimiento: sin actividad</div>
      <div class="ver-historial" onclick="window.location.href='historial.html'">Ver historial</div>
    </div>

    <div class="card acciones">
      <button class="btn" id="addSaldoBtn">üí∞ Agregar saldo</button>
      <button class="btn" id="btnMetodosPago">üí≥ M√©todos de pago</button>
      <button class="btn" id="btnDatosCuenta">üë§ Datos de la cuenta</button>
      <button class="btn soporte-btn" id="btnSoporte">üÜò Soporte</button>
      <button class="btn" id="logoutBtn">üö™ Cerrar sesi√≥n</button>

      <div class="legales">
  <a href="terminos.html" target="_blank" rel="noopener">T√©rminos</a> ‚Ä¢
  <a href="privacidad.html" target="_blank" rel="noopener">Privacidad</a> ‚Ä¢
  <a href="reembolsos.html" target="_blank" rel="noopener">Reembolsos</a>
</div>


  </main>

  <!-- MODAL: IMPORTE SALDO -->
  <div id="modal-bg-saldo" class="modal-bg-saldo">
    <div class="modal">
      <div>Introduce la cantidad que deseas agregar (m√≠nimo 10 ‚Ç¨):</div>
      <input id="saldoInput" type="number" min="10" />
      <button id="btnAgregarSaldo">Agregar</button>
    </div>
  </div>

  <!-- MODAL: M√âTODO DE PAGO -->
  <div id="modal-bg-metodo" class="modal-bg-metodo">
    <div class="modal">
      <div style="font-weight:700;">Selecciona tu m√©todo de pago</div>
      <div style="font-size:12px;opacity:0.9;margin-top:4px;">
        Podr√°s cambiarlo m√°s adelante en ‚ÄúM√©todos de pago‚Äù.
      </div>

      <div class="metodo-lista" id="listaMetodos">
        <div class="metodo-opcion" data-metodo="Tarjeta (Visa/Mastercard)">
          <span class="metodo-nombre">üí≥ Visa / Mastercard</span>
          <span class="metodo-tag">Tarjeta</span>
        </div>
        <div class="metodo-opcion" data-metodo="PayPal">
          <span class="metodo-nombre">üÖøÔ∏è PayPal</span>
          <span class="metodo-tag">Wallet</span>
        </div>
        <div class="metodo-opcion" data-metodo="Apple Pay">
          <span class="metodo-nombre">üçè Apple Pay</span>
          <span class="metodo-tag">M√≥vil</span>
        </div>
        <div class="metodo-opcion" data-metodo="Google Pay">
          <span class="metodo-nombre">ü§ñ Google Pay</span>
          <span class="metodo-tag">M√≥vil</span>
        </div>
        <div class="metodo-opcion" data-metodo="Bizum">
          <span class="metodo-nombre">üì≤ Bizum</span>
          <span class="metodo-tag">Espa√±a</span>
        </div>
      </div>

      <button id="cerrarMetodo">Cerrar</button>
    </div>
  </div>

  <!-- MODAL: DATOS DE LA CUENTA -->
  <div id="modal-bg-cuenta" class="modal-bg-cuenta">
    <div class="modal">
      <div style="font-weight:700; margin-bottom:6px;">Datos de tu cuenta</div>
      <div style="font-size:12px; opacity:0.9;">
        Podr√°s editar estos datos m√°s adelante desde esta secci√≥n.
      </div>

      <div class="cuenta-campos">
        <div class="campo">
          <div class="campo-label">Nombre</div>
          <input id="cuentaNombre" type="text" placeholder="Usuario">
        </div>

        <div class="campo">
          <div class="campo-label">Correo</div>
          <input id="cuentaCorreo" type="email" readonly>
        </div>

        <div class="campo campo-password">
          <div class="campo-label">Contrase√±a</div>
          <input id="cuentaPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          <span id="togglePass" class="ojo-toggle">üëÅ</span>
        </div>

        <div class="campo">
          <div class="campo-label">M√©todo de pago actual</div>
          <input id="cuentaMetodo" type="text" readonly placeholder="Sin m√©todo guardado">
        </div>
      </div>

      <button id="cerrarCuenta">Cerrar</button>
    </div>
  </div>

  <!-- NUEVO MODAL: MONEDAS -->
  <div id="modal-bg-monedas" class="modal-bg-monedas">
    <div class="modal-monedas">
      <div style="font-weight:700;">Sistema de recompensas</div>

      <p style="font-size:13px;margin-top:8px;">
        ‚úÖ <b>Tus recargas te premian:</b> acumula <b>699 monedas</b> y canj√©alas por <b>20 ‚Ç¨</b>.
      </p>

      <p style="font-size:12px;opacity:0.9;margin-top:6px;">
        Las monedas se generan autom√°ticamente seg√∫n el importe de cada recarga.
      </p>

      <div class="progress-bar">
        <div class="progress-fill" id="barraProgreso"></div>
      </div>

      <div id="progresoTexto" style="margin-top:8px;font-size:13px;"></div>

      <button id="btnCanje" class="btn-canje">Canjear 20 ‚Ç¨</button>

      <div style="font-size:11px;opacity:0.8;margin-top:10px;">
        Las monedas solo son v√°lidas dentro de la app.
      </div>

      <button id="cerrarMonedas" style="margin-top:12px;">Cerrar</button>
    </div>
  </div>

  <nav class="bottom">
    <a href="recargar.html" class="nav-btn">
      <span>‚ö°</span>
      <div>Recargar</div>
    </a>
    <a href="historial.html" class="nav-btn">
      <span>üìú</span>
      <div>Historial</div>
    </a>
    <a href="cuenta.html" class="nav-btn active">
      <span>üë§</span>
      <div>Cuenta</div>
    </a>
  </nav>

  <script>
    // Sesi√≥n y datos del usuario
    const usuarioSesion     = localStorage.getItem("usuario");
    const datosUsuario      = JSON.parse(localStorage.getItem("usuarioRegistrado") || "{}");

    if (!usuarioSesion) {
      window.location.href = "index.html";
    }

    // üë§ Mostrar NOMBRE bajo el avatar (no el correo)
    const nombreMostrar = datosUsuario.nombre || "Usuario";
    document.getElementById("emailUsuario").textContent = nombreMostrar;

    function cargarSaldo() {
      let saldo = parseFloat(localStorage.getItem("rpc_saldo")) || 0;
      document.getElementById("saldo").textContent = saldo.toFixed(2) + " ‚Ç¨";
    }

    function cargarUltimoMovimiento() {
      const cont = document.getElementById("ultimoMovimiento");
      const historial = JSON.parse(localStorage.getItem("rpc_historial") || "[]");

      if (!historial.length) {
        cont.textContent = "√öltimo movimiento: sin actividad";
        return;
      }

      const ultimo = historial[0];

      if (ultimo.tipo === "recarga") {
        cont.textContent =
          "√öltimo movimiento: Recarga de " +
          ultimo.importe.toFixed(2) + " ‚Ç¨ a " + (ultimo.numero || "");
      } else if (ultimo.tipo === "saldo") {
        cont.textContent =
          "√öltimo movimiento: Saldo agregado +" +
          ultimo.importe.toFixed(2) + " ‚Ç¨";
      } else {
        cont.textContent = "√öltimo movimiento: Movimiento registrado";
      }
    }

    function getMetodoPagoActual() {
      return localStorage.getItem("rpc_metodo_pago") || null;
    }

    function abrirModalSaldo() {
      document.getElementById("modal-bg-saldo").style.display = "flex";
      document.getElementById("saldoInput").value = "";
    }

    function cerrarModalSaldo() {
      document.getElementById("modal-bg-saldo").style.display = "none";
    }

    function abrirModalMetodo() {
      document.getElementById("modal-bg-metodo").style.display = "flex";
    }

    function cerrarModalMetodo() {
      document.getElementById("modal-bg-metodo").style.display = "none";
    }

    function abrirModalCuenta() {
      const modalBg    = document.getElementById("modal-bg-cuenta");
      const inputNombre= document.getElementById("cuentaNombre");
      const inputCorreo= document.getElementById("cuentaCorreo");
      const inputPass  = document.getElementById("cuentaPass");
      const inputMetodo= document.getElementById("cuentaMetodo");

      // üîÑ Cargar datos reales del registro
      const nombreGuardado = datosUsuario.nombre || "Usuario";
      const correoGuardado = datosUsuario.email  || usuarioSesion || "";
      const passGuardada   = datosUsuario.pass   || "";
      const metodo         = getMetodoPagoActual() || "Sin m√©todo guardado";

      inputNombre.value = nombreGuardado;
      inputCorreo.value = correoGuardado;
      inputPass.value   = passGuardada;
      inputMetodo.value = metodo;

      // Siempre iniciar en modo oculto
      inputPass.type = "password";
      document.getElementById("togglePass").textContent = "üëÅ";

      modalBg.style.display = "flex";
    }

    function cerrarModalCuenta() {
      document.getElementById("modal-bg-cuenta").style.display = "none";
    }

    cargarSaldo();
    cargarUltimoMovimiento();

    // Agregar saldo
    document.getElementById("addSaldoBtn").addEventListener("click", () => {
      const metodo = getMetodoPagoActual();
      if (!metodo) {
        abrirModalMetodo();
      } else {
        abrirModalSaldo();
      }
    });

    document.querySelectorAll(".metodo-opcion").forEach(op => {
      op.addEventListener("click", () => {
        const metodo = op.getAttribute("data-metodo");
        if (!metodo) return;
        localStorage.setItem("rpc_metodo_pago", metodo);
        cerrarModalMetodo();
        abrirModalSaldo();
      });
    });

    document.getElementById("cerrarMetodo").addEventListener("click", cerrarModalMetodo);

    document.getElementById("modal-bg-metodo").addEventListener("click", (e) => {
      if (e.target.id === "modal-bg-metodo") cerrarModalMetodo();
    });

    document.getElementById("modal-bg-saldo").addEventListener("click", (e) => {
      if (e.target.id === "modal-bg-saldo") cerrarModalSaldo();
    });

    document.getElementById("btnAgregarSaldo").addEventListener("click", () => {
      let cantidad = parseFloat(document.getElementById("saldoInput").value);

      if (isNaN(cantidad) || cantidad < 10) {
        alert("El importe m√≠nimo para agregar saldo es de 10 ‚Ç¨.");
        return;
      }

      let saldoActual = parseFloat(localStorage.getItem("rpc_saldo")) || 0;
      let nuevoSaldo = saldoActual + cantidad;
      localStorage.setItem("rpc_saldo", nuevoSaldo);

      let historial = JSON.parse(localStorage.getItem("rpc_historial") || "[]");
      const metodo = getMetodoPagoActual() || "Sin m√©todo";

      historial.unshift({
        tipo: "saldo",
        importe: cantidad,
        fecha: new Date().toLocaleString(),
        metodo: metodo
      });
      localStorage.setItem("rpc_historial", JSON.stringify(historial));

      cerrarModalSaldo();
      cargarSaldo();
      cargarUltimoMovimiento();
    });

    // M√©todos de pago
    const btnMetodosPago = document.getElementById("btnMetodosPago");
    btnMetodosPago.addEventListener("click", () => {
      const metodo = getMetodoPagoActual();
      if (!metodo) {
        const quiere = confirm(
          "A√∫n no tienes ning√∫n m√©todo de pago guardado.\n\n¬øQuieres seleccionar uno ahora?"
        );
        if (quiere) abrirModalMetodo();
      } else {
        const quiere = confirm(
          "M√©todo de pago actual:\n\n" +
          metodo +
          "\n\n¬øQuieres cambiarlo?"
        );
        if (quiere) abrirModalMetodo();
      }
    });

    // Datos de la cuenta
    const btnDatosCuenta = document.getElementById("btnDatosCuenta");
    btnDatosCuenta.addEventListener("click", abrirModalCuenta);

    // üëÅ Toggle ojito contrase√±a
    document.getElementById("togglePass").addEventListener("click", () => {
      const input = document.getElementById("cuentaPass");
      const icono = document.getElementById("togglePass");
      if (input.type === "password") {
        input.type = "text";
        icono.textContent = "üôà";
      } else {
        input.type = "password";
        icono.textContent = "üëÅ";
      }
    });

    document.getElementById("cerrarCuenta").addEventListener("click", cerrarModalCuenta);

    document.getElementById("modal-bg-cuenta").addEventListener("click", (e) => {
      if (e.target.id === "modal-bg-cuenta") cerrarModalCuenta();
    });

    // Soporte
    const btnSoporte = document.getElementById("btnSoporte");
    btnSoporte.addEventListener("click", () => {
      window.location.href =
        "mailto:recargaspacubaapp@gmail.com" +
        "?subject=Soporte%20RecargasPaCuba" +
        "&body=Hola%20equipo%20RecargasPaCuba,%0D%0A%0D%0A";
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("usuario");
      window.location.href = "index.html";
    });

    // ‚úÖ AVATAR: cargar/guardar foto en localStorage
    const avatarBox   = document.getElementById("avatarBox");
    const inputAvatar = document.getElementById("inputAvatar");
    const avatarImg   = document.getElementById("avatarImg");
    const avatarIcon  = document.querySelector(".avatar svg");

    const avatarGuardado = localStorage.getItem("rpc_avatar");
    if (avatarGuardado) {
      avatarImg.src = avatarGuardado;
      avatarImg.style.display = "block";
      if (avatarIcon) avatarIcon.style.display = "none";
    }

    if (avatarBox && inputAvatar && avatarImg) {
      avatarBox.addEventListener("click", () => {
        inputAvatar.click();
      });

      inputAvatar.addEventListener("change", () => {
        const file = inputAvatar.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          const dataUrl = e.target.result;
          localStorage.setItem("rpc_avatar", dataUrl);
          avatarImg.src = dataUrl;
          avatarImg.style.display = "block";
          if (avatarIcon) avatarIcon.style.display = "none";
        };
        reader.readAsDataURL(file);
      });
    }

    /* ========= L√ìGICA MONEDAS ========= */

    function monedasPorImporte(importe){
      if (importe >= 25) return 32;
      if (importe >= 20) return 25;
      if (importe >= 15) return 18;
      if (importe >= 10) return 12;
      if (importe >= 5)  return 5;
      return 0;
    }

    function calcularMonedas(){
      const historial = JSON.parse(localStorage.getItem("rpc_historial") || "[]");
      let total = 0;

      historial.forEach(mov => {
        if (mov.tipo === "recarga") {
          total += monedasPorImporte(mov.importe);
        }
      });

      localStorage.setItem("rpc_monedas", total);

      const coinSpan = document.getElementById("coinTotal");
      if (coinSpan) coinSpan.textContent = total;

      const progreso = Math.min((total / 699) * 100, 100);
      const barra = document.getElementById("barraProgreso");
      if (barra) barra.style.width = progreso + "%";

      const texto = document.getElementById("progresoTexto");
      if (texto) texto.textContent = total + " / 699 monedas";

      const btnCanje = document.getElementById("btnCanje");
      if (btnCanje) {
        if (total >= 699) {
          btnCanje.classList.add("activo");
          btnCanje.disabled = false;
        } else {
          btnCanje.classList.remove("activo");
          btnCanje.disabled = true;
        }
      }
    }

    const coinWidget = document.getElementById("coinWidget");
    const modalMonedas = document.getElementById("modal-bg-monedas");
    const cerrarMonedasBtn = document.getElementById("cerrarMonedas");

    if (coinWidget && modalMonedas) {
      coinWidget.addEventListener("click", () => {
        modalMonedas.style.display = "flex";
      });

      modalMonedas.addEventListener("click", (e) => {
        if (e.target.id === "modal-bg-monedas") {
          modalMonedas.style.display = "none";
        }
      });
    }

    if (cerrarMonedasBtn) {
      cerrarMonedasBtn.addEventListener("click", () => {
        modalMonedas.style.display = "none";
      });
    }

    const btnCanje = document.getElementById("btnCanje");
    if (btnCanje) {
      btnCanje.addEventListener("click", () => {
        if (!btnCanje.classList.contains("activo")) return;
        alert("Canje disponible: aqu√≠ podr√°s reclamar tus 20 ‚Ç¨ cuando est√© conectado al sistema real.");
        // M√°s adelante: restar 699 monedas, sumar saldo, etc.
      });
    }

    calcularMonedas();
  </script>

</body>
</html>
